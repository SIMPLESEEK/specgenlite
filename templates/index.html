<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>产品规格书生成器</title>
    <style>
        /* 页面基础样式 */
        body {
            margin: 0;
            padding: 20px;
            font-family: "Microsoft YaHei", sans-serif;
            background: #f0f0f0;
            min-height: 100vh;
            overflow-y: scroll;  /* 始终显示滚动条，防止页面跳动 */
        }

        /* A4 页面容器 */
        .preview-page {
            position: relative;
            margin: 0 auto;
            padding: 20mm;
            width: 210mm;
            height: 297mm;
            background: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            transform: translateZ(0);  /* 创建新的堆叠上下文 */
        }

        /* 防止按钮导致页面重排 */
        .preview-page::after {
            content: '';
            display: block;
            height: 120px;  /* 预留按钮空间 */
            width: 100%;
        }

        /* 页眉部分优化 */
        .preview-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 9mm;
            align-items: flex-start;
            padding-bottom: 10px;
            margin-top: 0;
            border-bottom: 1px solid #f0f0f0;
            padding-top: 2mm;
            width: 170mm;
            margin-left: auto;
            margin-right: auto;
        }

        .title-area {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-top: -8mm;
            padding-top: 0;
            width: 200px;  /* 确保与LOGO区域宽度一致 */
        }

        .header-input {
            font-size: 15px;
            color: #333;
            border: 1px solid transparent;
            width: 200px;
            padding: 0;
            transition: border-color 0.2s;
        }

        .header-input.brand {
            font-weight: bold;
        }

        .product-title:focus,
        .product-brand:focus,
        .product-model:focus,
        .product-description textarea:focus,
        .params-table input:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.1);
            background-color: #fff;
        }

        .product-title:hover,
        .product-brand:hover,
        .product-model:hover,
        .product-description textarea:hover,
        .params-table input:hover {
            border-color: #e0e0e0;
            background-color: #fafafa;
        }

        /* LOGO 区域优化 */
        .logo-area {
            width: 200px;
            margin-top: -8mm;  /* 向上移动LOGO */
            text-align: right;
            display: flex;
            justify-content: flex-end;
            align-items: flex-start;
            cursor: pointer;
            position: relative;
            transition: opacity 0.2s;
            padding-right: 0;
        }

        .logo-area:hover {
            opacity: 0.8;
        }

        .logo-area input[type="file"] {
            display: none;
        }

        .logo-area img {
            height: 80px;
            width: auto;
            object-fit: contain;
            max-width: 100%;
            transition: transform 0.2s;
            margin-top: -2mm;  /* 微调图片位置 */
        }

        .logo-area:hover img {
            transform: scale(1.02);
        }

        .logo-area::after {
            content: '点击更换LOGO';
            position: absolute;
            bottom: -15px;
            right: 0;
            font-size: 11px;
            color: #999;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .logo-area:hover::after {
            opacity: 1;
        }

        /* 主要内容区域 */
        .preview-content {
            display: flex;
            gap: 15mm;
        }

        /* 左侧区域 */
        .preview-left {
            display: flex;
            flex-direction: column;
            gap: 9mm;
            margin-left: 20mm;  /* 与"芮光"左对齐 */
        }

        /* 产品图片区域 */
        .preview-image,
        .preview-diagram {
            width: 90mm;  /* 进一步增加宽度 */
            height: 90mm;  /* 进一步增加高度 */
            border: 1px dashed #ddd;
            cursor: pointer;
            position: relative;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* 产品线图特殊样式 */
        .preview-diagram {
            height: 70mm;  /* 相应增加线图高度 */
        }

        /* 配件图片区域 */
        .accessories-container {
            position: absolute;
            bottom: 30mm;
            left: 40mm;  /* 与产品图片左对齐 */
            width: 70mm;
        }

        .accessories-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8mm;
        }

        /* 配件图和配光曲线的容器样式 */
        .accessory-box,
        .curve-box {
            width: 35mm;  /* 增加宽度 */
            height: 35mm;  /* 增加高度 */
            border: 1px dashed #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            background: #fff;
            position: relative;
            overflow: hidden;
        }

        .accessory-box:hover {
            border-color: #999;
        }

        /* 配光曲线区域 */
        .light-curves {
            position: absolute;
            bottom: 30mm;
            left: 135mm;  /* 调整位置，使与参数名称左对齐 */
            width: 70mm;
        }

        .curves-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 8mm;  /* 增加间距，与配件图保持一致 */
            width: 100%;
        }

        .curve-box:hover {
            border-color: #999;
        }

        /* 只对配光曲线图应用黑白效果 */
        .curves-grid .curve-box img {
            filter: grayscale(100%) !important;
        }

        /* 打印时隐藏空的配光曲线框 */
        @media print {
            body {
                margin: 0;
                padding: 0;
                background: none;
            }

            .preview-page {
                margin: 0;
                padding: 20mm;
                width: 210mm;
                height: 297mm;
                box-shadow: none;
            }

            /* 隐藏没有输入值的参数行 */
            .params-table tr:has(input:not([value]), input[value=""]) {
                display: none !important;
            }

            /* 移除输入框样式 */
            .params-table input {
                border: none;
                padding: 0;
                background: none;
            }

            /* 固定配件图位置 */
            .accessories-container {
                position: fixed !important;
                bottom: 30mm !important;
                left: 40mm !important;  /* 与网页显示时相同 */
                width: 70mm !important;
            }

            /* 固定配光曲线位置 */
            .light-curves {
                position: fixed !important;
                bottom: 30mm !important;
                left: 135mm !important;  /* 与网页显示时相同 */
                width: 70mm !important;
            }

            /* 固定页脚位置 */
            .preview-footer {
                position: fixed !important;
                bottom: 5mm !important;
                left: 50% !important;
                transform: translateX(-50%) !important;
                width: 170mm !important;
            }

            @page {
                size: 210mm 297mm;
                margin: 0;
            }

            .print-btn {
                display: none !important;
            }

            /* 隐藏没有图片的容器和删除按钮 */
            .preview-image:not(:has(img[style*="display: block"])),
            .preview-diagram:not(:has(img[style*="display: block"])),
            .accessory-box:not(:has(img)),
            .curve-box:not(:has(img)),
            .delete-btn {
                display: none !important;
            }
        }

        /* 图片占位符样式优化 */
        .image-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            color: #999;
            transition: all 0.2s ease;
            padding: 10px;
            box-sizing: border-box;
        }

        .image-placeholder svg {
            width: 24px;
            height: 24px;
            margin-bottom: 10px;
            transition: transform 0.2s ease;
        }

        .image-placeholder span {
            font-size: 13px;
            margin-bottom: 6px;
            transition: color 0.2s ease;
        }

        .image-placeholder small {
            font-size: 11px;
            color: #bbb;
            transition: color 0.2s ease;
        }

        /* 悬停效果 */
        .preview-image:hover .image-placeholder,
        .preview-diagram:hover .image-placeholder,
        .accessory-box:hover .image-placeholder {
            color: #4CAF50;
        }

        .preview-image:hover .image-placeholder svg,
        .preview-diagram:hover .image-placeholder svg,
        .accessory-box:hover .image-placeholder svg,
        .curve-box:hover .image-placeholder svg {
            transform: scale(1.1);
            fill: #4CAF50;
        }

        .preview-image:hover .image-placeholder small,
        .preview-diagram:hover .image-placeholder small,
        .accessory-box:hover .image-placeholder small,
        .curve-box:hover .image-placeholder small {
            color: #999;
        }

        /* 统一所有图片上传区域的样式 */
        .image-placeholder svg {
            margin-bottom: 8px;
        }

        .image-placeholder span {
            display: block;
            margin-bottom: 4px;
        }

        /* 统一图片上传区域的交互效果 */
        .preview-image:hover,
        .preview-diagram:hover,
        .accessory-box:hover,
        .curve-box:hover {
            border-color: #4CAF50;
            background-color: #f9f9f9;
        }

        /* 图片容器内的图片样式 */
        .preview-image img,
        .preview-diagram img,
        .accessory-box img,
        .curve-box img {
            max-width: 95%;  /* 缩小到95%确保不会挡住边框 */
            max-height: 95%;
            object-fit: contain;
            position: relative;
            z-index: 1;
            margin: auto;  /* 确保图片居中 */
        }

        /* 当容器有图片时的边框样式 */
        .preview-image:has(img:not([style*="display: none"])),
        .preview-diagram:has(img:not([style*="display: none"])),
        .accessory-box:has(img),
        .curve-box:has(img) {
            border: 1px solid #666 !important;  /* 实线边框 */
        }

        /* 删除按钮样式 */
        .delete-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 20px;
            height: 20px;
            background: #ff4444;
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 14px;
            line-height: 1;
            cursor: pointer;
            display: none;
            z-index: 999;
            padding: 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            opacity: 0.8;
            transition: opacity 0.2s;
        }

        .delete-btn:hover {
            opacity: 1;
        }

        /* 当容器有图片时显示删除按钮 */
        .preview-image:has(img[style*="display: block"]) .delete-btn,
        .preview-diagram:has(img[style*="display: block"]) .delete-btn,
        .accessory-box:has(img) .delete-btn,
        .curve-box:has(img) .delete-btn {
            display: block;
            opacity: 0;  /* 默认隐藏 */
            transition: opacity 0.2s;
        }

        /* 鼠标悬停时显示删除按钮 */
        .preview-image:hover .delete-btn,
        .preview-diagram:hover .delete-btn,
        .accessory-box:hover .delete-btn,
        .curve-box:hover .delete-btn {
            opacity: 0.8;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* 图片上传区域交互优化 */
        .image-placeholder svg,
        .image-placeholder span {
            transition: all 0.2s ease;
        }

        .preview-image:hover .image-placeholder svg,
        .preview-diagram:hover .image-placeholder svg,
        .accessory-box:hover .image-placeholder svg,
        .curve-box:hover .image-placeholder svg {
            fill: #4CAF50;
            transform: scale(1.1);
        }

        .preview-image:hover .image-placeholder span,
        .preview-diagram:hover .image-placeholder span,
        .accessory-box:hover .image-placeholder span,
        .curve-box:hover .image-placeholder span {
            color: #4CAF50;
        }

        /* 页面加载动画 */
        @keyframes fadeInPage {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* 图片加载动画 */
        .image-loader {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 30px;
            height: 30px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4CAF50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        /* 自定义滚动条样式 */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #999;
        }

        /* 优化输入框自动完成样式 */
        input:-webkit-autofill,
        input:-webkit-autofill:hover,
        input:-webkit-autofill:focus {
            -webkit-box-shadow: 0 0 0px 1000px white inset;
            -webkit-text-fill-color: #333;
            transition: background-color 5000s ease-in-out 0s;
        }

        /* 添加 Toast 提示样式 */
        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 12px 24px;
            border-radius: 4px;
            font-size: 14px;
            z-index: 1001;
            opacity: 0;
            transition: opacity 0.3s;
            font-family: "Microsoft YaHei", sans-serif;
        }

        /* 添加输入框悬停效果 */
        .product-brand:hover,
        .product-model:hover,
        .product-description textarea:hover,
        .params-table input:hover {
            border-color: #e0e0e0;
            background-color: #fafafa;
        }

        /* 添加图片上传区域的过渡动画 */
        .preview-image,
        .preview-diagram,
        .accessory-box,
        .curve-box {
            transition: all 0.3s ease;
        }

        /* 优化图片上传区域的悬停效果 */
        .preview-image:hover,
        .preview-diagram:hover,
        .accessory-box:hover,
        .curve-box:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        /* 添加参数表格行的过渡动画 */
        .params-table tr {
            transition: background-color 0.2s ease;
        }

        /* 优化打印按钮的过渡效果 */
        .print-btn {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* 添加页面载入动画 */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .preview-page {
            animation: fadeInUp 0.5s ease-out;
        }

        /* 添加图片压缩进度条样式 */
        .compress-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 2px;
            background: #4CAF50;
            width: 0;
            transition: width 0.3s ease;
        }

        /* 优化图片加载时的占位效果 */
        .image-placeholder.loading {
            background: linear-gradient(90deg, #f0f0f0 25%, #e8e8e8 37%, #f0f0f0 63%);
            background-size: 400% 100%;
            animation: shimmer 1.4s ease infinite;
        }

        @keyframes shimmer {
            0% { background-position: 100% 50%; }
            100% { background-position: 0 50%; }
        }

        /* 拖拽上传区域样式 */
        .drag-over {
            border-color: #4CAF50 !important;
            background-color: rgba(76, 175, 80, 0.05) !important;
            position: relative;
        }

        .drag-over::after {
            content: '释放鼠标上传图片';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 12px;
            z-index: 10;
        }

        /* 图片预览模态框样式 */
        .image-preview-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .image-preview-content {
            max-width: 90vw;
            max-height: 90vh;
            position: relative;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .image-preview-content img {
            max-width: 100%;
            max-height: calc(90vh - 100px);
            object-fit: contain;
        }

        .preview-controls {
            margin-top: 15px;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .preview-controls button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            font-family: "Microsoft YaHei", sans-serif;
        }

        /* 页脚部分优化 */
        .preview-footer {
            position: absolute;
            bottom: 5mm;
            left: 20mm;
            right: 20mm;
            padding: 10px 0 0;
            font-size: 9px;
            color: #666;
            border-top: 1px solid #eee;
            margin-bottom: 0;
            width: 170mm;
            margin-left: auto;
            margin-right: auto;
        }

        .footer-content {
            display: flex;
            justify-content: space-around;
            margin-bottom: 4mm;
            line-height: 1.4;
            font-family: "Microsoft YaHei", sans-serif;
            letter-spacing: 0.2px;
        }

        .footer-section {
            flex: 1;
            max-width: 30%;
            line-height: 1.6;
            color: #555;
            text-align: left;
            padding: 0 10px;
            cursor: text;
            overflow: hidden;  /* 确保内容不会溢出 */
        }

        .footer-input {
            width: 100%;
            border: 1px solid transparent;
            background: transparent;
            font-size: inherit;
            color: inherit;
            font-family: inherit;
            line-height: inherit;
            padding: 0;
            margin: 0;
            transition: border-color 0.2s;
            white-space: nowrap;  /* 强制单行显示 */
            overflow: hidden;     /* 隐藏超出部分 */
            text-overflow: ellipsis;  /* 超出显示省略号 */
        }

        .footer-input:hover {
            border-color: #e0e0e0;
        }

        .footer-input:focus {
            outline: none;
            border-color: #4CAF50;
            background-color: rgba(255, 255, 255, 0.9);
        }

        .footer-section:last-child {
            color: #888;
            font-size: 8px;
        }

        /* 参数表格样式优化 */
        .params-table tr {
            height: 24px;  /* 行高 */
            margin-bottom: 6px;  /* 设置行间距为6px */
            border-collapse: collapse;
        }

        .params-table td.param-name {
            width: 95px;
            color: #666;
            font-size: 12px;
            text-align: left;
            font-family: "Microsoft YaHei", sans-serif;
            font-weight: 500;
            letter-spacing: 0.2px;
            padding-right: 10px;
        }

        .params-table td.param-value {
            width: auto;
        }

        .params-table input {
            border: none;
            padding: 4px 8px;
            width: 100%;
            font-size: 13px;
            color: #333;
            font-family: "Microsoft YaHei", sans-serif;
            text-align: left;
            background: transparent;
            padding-left: 0;
            padding-right: 0;
            letter-spacing: 0.2px;
            font-weight: normal;
        }

        /* 输入框的占位符文字样式 */
        .params-table input::placeholder {
            color: #999;  /* 保持占位符文字颜色较浅 */
            font-size: 13px;
            font-weight: normal;
        }

        /* 补充信息文本框样式 */
        .supplementary-info {
            transition: min-height 0.2s;
        }

        .supplementary-info:focus {
            min-height: 60px;  /* 获得焦点时增加高度 */
        }

        /* 打印时补充信息的样式 */
        @media print {
            .supplementary-info {
                resize: none;
                overflow: hidden;
                height: auto !important;
            }
        }

        /* 补充信息名称编辑样式 */
        .param-name.editable {
            cursor: text;
            transition: background-color 0.2s;
        }

        .param-name.editable:hover {
            background-color: rgba(0, 0, 0, 0.02);
        }

        .param-name.editable:focus {
            outline: none;
            background-color: rgba(0, 0, 0, 0.05);
        }

        /* 导出PDF按钮样式优化 */
        .print-btn {
            position: absolute;
            right: 40px;
            top: 40px;
            padding: 12px 24px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-family: "Microsoft YaHei", sans-serif;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .print-btn:hover {
            background-color: #45a049;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: translateY(-1px);
        }

        .print-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* 添加PDF图标 */
        .print-btn::before {
            content: '';
            display: inline-block;
            width: 18px;
            height: 18px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3E%3Cpath d='M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z'/%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
        }

        /* 右侧区域样式 */
        .preview-right {
            width: 85mm;
            margin-left: -10mm;  /* 使用负边距向左移动 */
        }
    </style>
</head>
<body>
    <div class="preview-page">
        <div class="preview-header">
            <div class="title-area">
                <input type="text" class="header-input brand" value="芮光" data-i18n="brand">
                <input type="text" class="header-input" value="产品系列  " data-i18n="product-series">
                <input type="text" class="header-input" value="产品描述  " data-i18n="product-desc">
            </div>
            <div class="logo-area" onclick="uploadLogo()">
                <input type="file" id="logoInput" accept="image/*">
                <img id="logoImage" src="{{ url_for('static', filename='images/logo.png') }}" alt="RVS Lighting" data-i18n="logo-alt">
            </div>
        </div>

        <div class="preview-content">
            <div class="preview-left">
                <div class="preview-image" onclick="document.getElementById('productImage').click()">
                    <input type="file" id="productImage" accept="image/*" style="display: none;">
                    <div class="image-placeholder">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="#ccc">
                            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                        </svg>
                        <span>点击上传产品图片</span>
                        <small>建议尺寸: 900×900px</small>
                    </div>
                    <img id="previewImage" src="" style="display: none;">
                </div>
                <div class="preview-diagram" onclick="document.getElementById('productDiagram').click()">
                    <input type="file" id="productDiagram" accept="image/*" style="display: none;">
                    <div class="image-placeholder">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="#ccc">
                            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                        </svg>
                        <span data-i18n="upload-diagram">点击上传产品线图</span>
                        <small data-i18n="size-hint-diagram">建议尺寸: 800×600px</small>
                    </div>
                    <img id="diagramPreview" src="" style="display: none;">
                </div>
                <div class="accessories-container">
                    <div class="accessories-grid">
                        <div class="accessory-box" onclick="uploadAccessory(this, 0)">
                            <div class="image-placeholder">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="#ccc">
                                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                                </svg>
                                <span>配件图1</span>
                            </div>
                        </div>
                        <div class="accessory-box" onclick="uploadAccessory(this, 1)">
                            <div class="image-placeholder">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="#ccc">
                                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                                </svg>
                                <span>配件图2</span>
                            </div>
                        </div>
                        <div class="accessory-box" onclick="uploadAccessory(this, 2)">
                            <div class="image-placeholder">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="#ccc">
                                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                                </svg>
                                <span>配件图3</span>
                            </div>
                        </div>
                        <div class="accessory-box" onclick="uploadAccessory(this, 3)">
                            <div class="image-placeholder">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="#ccc">
                                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                                </svg>
                                <span>配件图4</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="preview-right">
                <table class="params-table">
                    <tr>
                        <td class="param-name" data-i18n="cut-out-size">开孔尺寸</td>
                        <td class="param-value">
                            <input type="text" placeholder="输入开孔尺寸" data-unit="mm" data-i18n="input-cut-out-size">
                        </td>
                    </tr>
                    <tr>
                        <td class="param-name" data-i18n="ceiling-thickness">适用天花厚度</td>
                        <td class="param-value">
                            <input type="text" placeholder="输入天花厚度" data-unit="mm" data-i18n="input-ceiling-thickness">
                        </td>
                    </tr>
                    <tr>
                        <td class="param-name" data-i18n="power">功率</td>
                        <td class="param-value">
                            <input type="text" placeholder="输入功率" data-unit="W" data-i18n="input-power">
                        </td>
                    </tr>
                    <tr>
                        <td class="param-name" data-i18n="luminous-flux">光通量</td>
                        <td class="param-value">
                            <input type="text" placeholder="输入光通量" data-unit="lm" data-i18n="input-luminous-flux">
                        </td>
                    </tr>
                    <tr>
                        <td class="param-name" data-i18n="beam-angle">光束角</td>
                        <td class="param-value">
                            <input type="text" placeholder="输入光束角" data-unit="°" data-i18n="input-beam-angle">
                        </td>
                    </tr>
                    <tr>
                        <td class="param-name" data-i18n="beam-pattern">光斑风格</td>
                        <td class="param-value">
                            <input type="text" placeholder="输入光斑风格" data-i18n="input-beam-pattern">
                        </td>
                    </tr>
                    <tr>
                        <td class="param-name" data-i18n="cct">色温</td>
                        <td class="param-value">
                            <input type="text" placeholder="输入色温" data-unit="K" data-i18n="input-cct">
                        </td>
                    </tr>
                    <tr>
                        <td class="param-name" data-i18n="cri">显色指数Ra</td>
                        <td class="param-value">
                            <input type="text" placeholder="输入显色指数" data-i18n="input-cri">
                        </td>
                    </tr>
                    <tr>
                        <td class="param-name" data-i18n="tlci-rf">色彩保真度Rf</td>
                        <td class="param-value">
                            <input type="text" placeholder="输入色彩保真度" data-i18n="input-tlci-rf">
                        </td>
                    </tr>
                    <tr>
                        <td class="param-name" data-i18n="tlci-rg">色彩饱和度Rg</td>
                        <td class="param-value">
                            <input type="text" placeholder="输入色彩饱和度" data-i18n="input-tlci-rg">
                        </td>
                    </tr>
                    <tr>
                        <td class="param-name" data-i18n="sdcm">色容差SDCM</td>
                        <td class="param-value">
                            <input type="text" placeholder="输入色容差" data-i18n="input-sdcm">
                        </td>
                    </tr>
                    <tr>
                        <td class="param-name" data-i18n="control">控制方式</td>
                        <td class="param-value">
                            <input type="text" placeholder="输入控制方式" data-i18n="input-control">
                        </td>
                    </tr>
                    <tr>
                        <td class="param-name" data-i18n="appearance-color">外观颜色</td>
                        <td class="param-value">
                            <input type="text" placeholder="输入外观颜色" data-i18n="input-appearance-color">
                        </td>
                    </tr>
                    <tr>
                        <td class="param-name" data-i18n="reflector-color">反射器颜色</td>
                        <td class="param-value">
                            <input type="text" placeholder="输入反射器颜色" data-i18n="input-reflector-color">
                        </td>
                    </tr>
                    <tr>
                        <td class="param-name" data-i18n="input-signal">输入信号</td>
                        <td class="param-value">
                            <input type="text" placeholder="输入信号" data-i18n="input-signal-placeholder">
                        </td>
                    </tr>
                    <tr>
                        <td class="param-name" data-i18n="ip-rating">防护等级</td>
                        <td class="param-value">
                            <input type="text" placeholder="输入防护等级" data-i18n="input-ip-rating">
                        </td>
                    </tr>
                    <tr>
                        <td class="param-name" data-i18n="material">材质</td>
                        <td class="param-value">
                            <input type="text" placeholder="输入材质" data-i18n="input-material">
                        </td>
                    </tr>
                    <tr>
                        <td class="param-name editable" contenteditable="true" data-i18n="additional-info">补充信息</td>
                        <td class="param-value">
                            <input type="text" placeholder="输入补充信息" data-i18n="input-additional-info">
                        </td>
                    </tr>
                </table>
            </div>
        </div>

        <div class="light-curves">
            <div class="curves-grid">
                <div class="curve-box" onclick="uploadCurve(this, 0)">
                    <div class="image-placeholder">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="#ccc">
                            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                        </svg>
                        <span data-i18n="curve-1">配光曲线1</span>
                    </div>
                </div>
                <div class="curve-box" onclick="uploadCurve(this, 1)">
                    <div class="image-placeholder">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="#ccc">
                            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                        </svg>
                        <span data-i18n="curve-2">配光曲线2</span>
                    </div>
                </div>
                <div class="curve-box" onclick="uploadCurve(this, 2)">
                    <div class="image-placeholder">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="#ccc">
                            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                        </svg>
                        <span data-i18n="curve-3">配光曲线3</span>
                    </div>
                </div>
                <div class="curve-box" onclick="uploadCurve(this, 3)">
                    <div class="image-placeholder">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="#ccc">
                            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                        </svg>
                        <span data-i18n="curve-4">配光曲线4</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="preview-footer">
            <div class="footer-content">
                <div class="footer-section">
                    <input type="text" class="footer-input" value="www.rvs-lighting.com"><br>
                    <input type="text" class="footer-input" value="上海芮维溪智能科技有限公司" data-i18n="company-name">
                </div>
                <div class="footer-section">
                    <input type="text" class="footer-input" value="sales@rvs-lighting.com"><br>
                    <input type="text" class="footer-input" value="上海市黄浦区巨鹿路417号701室" data-i18n="address-sh"><br>
                    <input type="text" class="footer-input" value="深圳市南山区南山云谷南风楼A座405室" data-i18n="address-sz">
                </div>
                <div class="footer-section">
                    <input type="text" class="footer-input" value="芮光保留对产品进行不定期设计更新的权利" data-i18n="rights"><br>
                    <input type="text" class="footer-input" value="2025.2">
                </div>
            </div>
        </div>
    </div>

    <button onclick="window.print()" class="print-btn" data-i18n="export-btn">导出规格书</button>

    <!-- 图片预览模态框 -->
    <div class="image-preview-modal">
        <div class="image-preview-content">
            <img src="" alt="预览图片">
            <div class="preview-controls">
                <button onclick="closeImagePreview()" style="background: #f5f5f5;" data-i18n="modal-close">关闭</button>
                <button onclick="confirmImage()" style="background: #4CAF50; color: white;" data-i18n="modal-confirm">确认</button>
            </div>
        </div>
    </div>

    <script>
        // 处理产品图片上传
        document.getElementById('productImage').addEventListener('change', function(e) {
            handleImageUpload(this, 'previewImage', 'image-placeholder');
        });

        // 处理产品线图上传
        document.getElementById('productDiagram').addEventListener('change', function(e) {
            handleImageUpload(this, 'diagramPreview', 'image-placeholder');
        });

        // 自动添加单位
        document.querySelectorAll('.params-table input').forEach(input => {
            const unit = input.dataset.unit;
            input.addEventListener('blur', function() {
                let value = this.value.trim();
                if (value) {
                    if (unit) {
                        // 检查是否已经包含单位
                        if (!value.endsWith(unit)) {
                            // 处理包含斜杠的情况
                            if (value.includes('/')) {
                                // 保持原始格式，只添加单位
                                value = value + unit;
                            } else {
                                // 处理普通数字
                                const numValue = parseFloat(value);
                                if (!isNaN(numValue)) {
                                    value = numValue + unit;
                                }
                            }
                        }
                    }
                    this.value = value;
                    this.setAttribute('value', value);  // 更新value属性
                }
            });

            input.addEventListener('focus', function() {
                let value = this.value.trim();
                if (value.endsWith(unit)) {
                    this.value = value.slice(0, -unit.length);
                }
            });
        });

        function uploadAccessory(box, index) {
            const input = createFileInput();
            input.onchange = (e) => handleSmallImageUpload(e, box);
            input.click();
        }

        function uploadCurve(box, index) {
            const input = createFileInput();
            input.onchange = (e) => handleCurveImageUpload(e, box);
            input.click();
        }

        function createFileInput() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            return input;
        }

        // 图片压缩函数
        async function compressImage(file, maxWidth = 1800, quality = 0.8) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (e) => {
                    const img = new Image();
                    img.src = e.target.result;
                    img.onload = () => {
                        try {
                            const canvas = document.createElement('canvas');
                            const ctx = canvas.getContext('2d');

                            // 计算压缩后的尺寸
                            let width = img.width;
                            let height = img.height;
                            if (width > maxWidth) {
                                height = (maxWidth * height) / width;
                                width = maxWidth;
                            }

                            canvas.width = width;
                            canvas.height = height;

                            // 先绘制白色背景
                            ctx.fillStyle = 'white';
                            ctx.fillRect(0, 0, width, height);

                            // 创建临时画布用于处理背景
                            const tempCanvas = document.createElement('canvas');
                            const tempCtx = tempCanvas.getContext('2d');
                            tempCanvas.width = width;
                            tempCanvas.height = height;
                            
                            // 在临时画布上绘制图片
                            tempCtx.drawImage(img, 0, 0, width, height);
                            
                            // 获取图片数据
                            const imageData = tempCtx.getImageData(0, 0, width, height);
                            const data = imageData.data;
                            
                            // 处理灰色背景
                            for (let i = 0; i < data.length; i += 4) {
                                // 检测灰色像素 (R=G=B)
                                if (Math.abs(data[i] - data[i+1]) < 5 && 
                                    Math.abs(data[i+1] - data[i+2]) < 5 && 
                                    data[i] < 240) {  // 不处理接近白色的像素
                                    // 增加透明度，使其与白色背景混合
                                    data[i+3] = Math.max(0, data[i+3] - 
                                        (240 - data[i]) * 0.8);
                                }
                            }
                            
                            // 将处理后的图片数据放回临时画布
                            tempCtx.putImageData(imageData, 0, 0);
                            
                            // 在主画布上绘制处理后的图片
                            ctx.drawImage(tempCanvas, 0, 0);

                            canvas.toBlob((blob) => {
                                if (blob) {
                                    resolve(blob);
                                } else {
                                    reject(new Error('Failed to create blob'));
                                }
                            }, 'image/jpeg', quality);
                        } catch (error) {
                            reject(error);
                        }
                    };
                    img.onerror = (error) => reject(error);
                };
                reader.onerror = (error) => reject(error);
            });
        }

        // 键盘快捷键支持
        document.addEventListener('keydown', function(e) {
            // Ctrl + P 打印
            if (e.ctrlKey && e.key === 'p') {
                e.preventDefault();
                window.print();
            }
            // Esc 关闭预览
            if (e.key === 'Escape') {
                closeImagePreview();
            }
        });

        // 拖拽上传支持
        const dropZones = document.querySelectorAll('.preview-image, .preview-diagram, .accessory-box, .curve-box');
        dropZones.forEach(zone => {
            zone.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.classList.add('drag-over');
            });

            zone.addEventListener('dragleave', function(e) {
                e.preventDefault();
                this.classList.remove('drag-over');
            });

            zone.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('drag-over');
                const file = e.dataTransfer.files[0];
                if (file && file.type.startsWith('image/')) {
                    if (this.classList.contains('preview-image')) {
                        handleImageUpload({ files: [file] }, 'previewImage', 'image-placeholder');
                    } else if (this.classList.contains('preview-diagram')) {
                        handleImageUpload({ files: [file] }, 'diagramPreview', 'image-placeholder');
                    } else {
                        handleSmallImageUpload({ target: { files: [file] } }, this);
                    }
                } else {
                    showToast('请上传图片文件');
                }
            });
        });

        // 图片预览功能
        let currentImageContext = null;
        const previewModal = document.querySelector('.image-preview-modal');
        const previewImage = previewModal.querySelector('img');

        function showImagePreview(file, context) {
            const reader = new FileReader();
            reader.onload = function(e) {
                previewImage.src = e.target.result;
                currentImageContext = context;
                previewModal.style.display = 'flex';
            };
            reader.readAsDataURL(file);
        }

        function closeImagePreview() {
            previewModal.style.display = 'none';
            previewImage.src = '';
            currentImageContext = null;
        }

        async function confirmImage() {
            if (currentImageContext) {
                const file = dataURLtoFile(previewImage.src, 'image.jpg');
                closeImagePreview();  // 立即关闭预览窗口

                if (currentImageContext.type === 'main') {
                    await handleImageUpload({ files: [file] }, currentImageContext.imgId, 'image-placeholder');
                } else {
                    await handleSmallImageUpload({ target: { files: [file] } }, currentImageContext.container);
                }
            }
        }

        function dataURLtoFile(dataurl, filename) {
            const arr = dataurl.split(',');
            const mime = arr[0].match(/:(.*?);/)[1];
            const bstr = atob(arr[1]);
            let n = bstr.length;
            const u8arr = new Uint8Array(n);
            while(n--) {
                u8arr[n] = bstr.charCodeAt(n);
            }
            return new File([u8arr], filename, {type: mime});
        }

        // 修改图片上传处理函数
        async function handleImageUpload(input, imgId, placeholderId) {
            const file = input.files[0];
            if (!file) return;

            if (!file.type.startsWith('image/')) {
                showToast('请上传图片文件');
                return;
            }

            try {
                const objectUrl = URL.createObjectURL(file);
                const img = document.getElementById(imgId);
                const container = img.parentElement;

                img.src = objectUrl;
                img.style.display = 'block';

                // 添加删除按钮
                let deleteBtn = container.querySelector('.delete-btn');
                if (!deleteBtn) {
                    deleteBtn = document.createElement('button');
                    deleteBtn.className = 'delete-btn';
                    deleteBtn.innerHTML = '×';
                    deleteBtn.onclick = (e) => {
                        e.stopPropagation();  // 阻止事件冒泡
                        img.src = '';
                        img.style.display = 'none';
                        deleteBtn.remove();
                        container.querySelector('.image-placeholder').style.display = 'flex';
                    };
                    container.appendChild(deleteBtn);
                }
                container.querySelector('.image-placeholder').style.display = 'none';
            } catch (error) {
                showToast('图片处理失败，请重试');
            }
        }

        // 修改小图片上传处理函数
        async function handleSmallImageUpload(event, container) {
            const file = event.target.files[0];
            if (!file) return;

            if (!file.type.startsWith('image/')) {
                showToast('请上传图片文件');
                return;
            }

            try {
                const objectUrl = URL.createObjectURL(file);
                const img = new Image();
                img.style.opacity = '0';
                img.style.maxWidth = '95%';
                img.style.maxHeight = '95%';
                img.style.objectFit = 'contain';

                img.onload = () => {
                    container.innerHTML = '';
                    container.appendChild(img);
                    
                    // 添加删除按钮
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'delete-btn';
                    deleteBtn.innerHTML = '×';
                    deleteBtn.onclick = (e) => {
                        e.stopPropagation();
                        container.innerHTML = `
                            <div class="image-placeholder">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="#ccc">
                                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                                </svg>
                                <span>配件图</span>
                            </div>
                        `;
                    };
                    container.appendChild(deleteBtn);
                    
                    requestAnimationFrame(() => {
                        img.style.opacity = '1';
                    });
                };
                img.src = objectUrl;
            } catch (error) {
                showToast('图片处理失败，请重试');
            }
        }

        async function handleCurveImageUpload(event, container) {
            const file = event.target.files[0];
            if (!file) return;

            if (!file.type.startsWith('image/')) {
                showToast('请上传图片文件');
                return;
            }

            try {
                const objectUrl = URL.createObjectURL(file);
                const img = new Image();
                img.style.opacity = '0';
                img.style.maxWidth = '95%';
                img.style.maxHeight = '95%';
                img.style.objectFit = 'contain';

                img.onload = () => {
                    container.innerHTML = '';
                    container.appendChild(img);
                    
                    // 添加删除按钮
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'delete-btn';
                    deleteBtn.innerHTML = '×';
                    deleteBtn.onclick = (e) => {
                        e.stopPropagation();
                        container.innerHTML = `
                            <div class="image-placeholder">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="#ccc">
                                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                                </svg>
                                <span>配光曲线</span>
                            </div>
                        `;
                    };
                    container.appendChild(deleteBtn);
                    
                    requestAnimationFrame(() => {
                        img.style.opacity = '1';
                    });
                };
                img.src = objectUrl;
            } catch (error) {
                console.error('Image processing error:', error);
                showToast('图片处理失败，请重试');
            }
        }

        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);

            requestAnimationFrame(() => {
                toast.style.opacity = '1';
                setTimeout(() => {
                    toast.style.opacity = '0';
                    setTimeout(() => {
                        document.body.removeChild(toast);
                    }, 300);
                }, 2000);
            });
        }

        // 处理LOGO上传
        function uploadLogo() {
            document.getElementById('logoInput').click();
        }

        document.getElementById('logoInput').addEventListener('change', async function(e) {
            const file = e.target.files[0];
            if (!file) return;

            if (!file.type.startsWith('image/')) {
                showToast('请上传图片文件');
                return;
            }

            if (file.size > 5 * 1024 * 1024) {
                showToast('图片大小不能超过 5MB');
                return;
            }

            try {
                // 压缩LOGO图片
                const compressedBlob = await compressImage(file, 800, 0.9);
                const objectUrl = URL.createObjectURL(compressedBlob);

                const logoImg = document.getElementById('logoImage');
                logoImg.style.opacity = '0';
                
                const tempImg = new Image();
                tempImg.onload = () => {
                    logoImg.src = objectUrl;
                    requestAnimationFrame(() => {
                        logoImg.style.opacity = '1';
                        setTimeout(() => {
                            URL.revokeObjectURL(objectUrl);
                        }, 300);
                    });
                };
                tempImg.src = objectUrl;
            } catch (error) {
                showToast('图片处理失败，请重试');
            }
        });
    </script>
</body>
</html> 